name: "Judicial Coherence Pulse"

on:
  push:
    branches: [ main ]

jobs:
  verify-judicial-law:
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout Judicial Source"
        uses: actions/checkout@v4

      - name: "Fetch Institutional Manifest"
        run: |
          curl -s https://raw.githubusercontent.com/Riverbraid/Riverbraid-Golds/main/TRUTH.md -o TRUTH.md

      - name: "Verify Judicial Invariant"
        run: |
          LOCAL_HASH=$(find . -type f -not -path '*/.*' -not -path './.github/*' -not -name 'TRUTH.md' | sort | xargs sha256sum | sha256sum | awk '{print $1}')
          EXPECTED_HASH=$(grep "*Judicial-Gold*" TRUTH.md | grep -oE "[0-9a-f]{64}" | head -n 1)
          
          echo "Local Judicial Hash: $LOCAL_HASH"
          echo "Institutional Hash: $EXPECTED_HASH"
          
          if [ "$LOCAL_HASH" != "$EXPECTED_HASH" ]; then
            echo "::error::JUDICIAL DISTORTION. Law does not match Institutional Manifest."
            exit 1
          fi
          echo "Judicial integrity confirmed."
